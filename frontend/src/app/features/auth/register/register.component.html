<div class="register-container">
  <mat-card class="register-card">
    <!-- Logo et Titre -->
    <div class="register-header">
      <div class="logo">
        <mat-icon>person_add</mat-icon>
      </div>
      <h1>Créer un compte</h1>
      <p>Rejoignez Mobile Money aujourd'hui</p>
    </div>

    <mat-card-content class="card-content">
      <div class="form-scroll">
        @if (serverError) {
          <div class="error-message">
            <mat-icon>error_outline</mat-icon>
            <span>{{ serverError }}</span>
          </div>
        }

        <form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="on">
          <!-- Nom / Prénom -->
          <div class="name-row">
            <mat-form-field appearance="outline" class="name-field">
              <mat-label>Prénom</mat-label>
              <input matInput type="text" formControlName="prenom" autocomplete="given-name" />
              <mat-icon matSuffix>person</mat-icon>
              @if (showError('prenom','required')) {
                <mat-error>Prénom requis</mat-error>
              }
              @if (showError('prenom','minlength')) {
                <mat-error>Minimum 2 caractères</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="name-field">
              <mat-label>Nom</mat-label>
              <input matInput type="text" formControlName="nom" autocomplete="family-name" />
              <mat-icon matSuffix>badge</mat-icon>
              @if (showError('nom','required')) {
                <mat-error>Nom requis</mat-error>
              }
              @if (showError('nom','minlength')) {
                <mat-error>Minimum 2 caractères</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Email -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" autocomplete="email" placeholder="Ex: jean@example.com" />
            <mat-icon matSuffix>email</mat-icon>
            @if (showError('email','required')) {
              <mat-error>Email requis</mat-error>
            }
            @if (showError('email','email')) {
              <mat-error>Email invalide</mat-error>
            }
          </mat-form-field>

          <!-- Pays + Téléphone -->
          <div class="phone-row">
            <mat-form-field appearance="outline" class="country-select">
              <mat-label>Pays</mat-label>
              <mat-select formControlName="country" panelClass="country-panel">
                @for (c of countries(); track c.code) {
                  <mat-option [value]="c.code">
                    <span class="country-option">
                      <span class="country-flag">{{ getCountryFlag(c.code) }}</span>
                      <span class="country-name">{{ c.nom }}</span>
                      <span class="country-dial">{{ c.indicatif }}</span>
                    </span>
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="phone-input">
              <mat-label>Numéro de téléphone</mat-label>
              <span matTextPrefix class="dial-prefix">{{ selectedCountry?.indicatif }}&nbsp;</span>
              <input
                matInput
                formControlName="phone"
                [placeholder]="phonePlaceholder || '70123456'"
                type="tel"
                inputmode="numeric"
                [maxlength]="requiredPhoneLength"
              />
              <mat-icon matSuffix>phone</mat-icon>
              <mat-hint>{{ requiredPhoneLength }} chiffres requis</mat-hint>
              @if (phoneError) {
                <mat-error>{{ phoneError }}</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Type de compte -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Type de compte</mat-label>
            <mat-select formControlName="accountType">
              <mat-option value="client">Client</mat-option>
              <mat-option value="marchand">Marchand</mat-option>
            </mat-select>
            <mat-icon matSuffix>badge</mat-icon>
            @if (showError('accountType','required')) {
              <mat-error>Type requis</mat-error>
            }
          </mat-form-field>

          <!-- Mot de passe -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Mot de passe</mat-label>
            <input
              matInput
              [type]="hidePassword ? 'password' : 'text'"
              formControlName="password"
              autocomplete="new-password"
            />
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="hidePassword = !hidePassword"
              [attr.aria-label]="hidePassword ? 'Afficher le mot de passe' : 'Masquer le mot de passe'"
            >
              <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-hint>Minimum 6 caractères</mat-hint>
            @if (showError('password','required')) {
              <mat-error>Mot de passe requis</mat-error>
            }
            @if (showError('password','minlength')) {
              <mat-error>Minimum 6 caractères</mat-error>
            }
          </mat-form-field>

          <!-- Confirmer mot de passe -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirmer le mot de passe</mat-label>
            <input
              matInput
              [type]="hideConfirmPassword ? 'password' : 'text'"
              formControlName="confirmPassword"
              autocomplete="new-password"
            />
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="hideConfirmPassword = !hideConfirmPassword"
              [attr.aria-label]="hideConfirmPassword ? 'Afficher' : 'Masquer'"
            >
              <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            @if (showError('confirmPassword','required')) {
              <mat-error>Confirmation requise</mat-error>
            }
            @if (form.hasError('passwordMismatch') && (form.get('confirmPassword')?.touched || form.get('confirmPassword')?.dirty)) {
              <mat-error>Les mots de passe ne correspondent pas</mat-error>
            }
          </mat-form-field>

          <!-- Info PIN -->
          <div class="pin-info-box">
            <mat-icon>info</mat-icon>
            <div>
              <strong>Le code PIN sera configuré après l'inscription.</strong>
              <div class="muted">Votre PIN protégera toutes vos transactions.</div>
            </div>
          </div>

          <!-- Submit -->
          <button
            mat-flat-button
            class="submit-btn full-width"
            type="submit"
            [disabled]="form.invalid || submitting"
          >
            @if (submitting) {
              <mat-spinner diameter="22"></mat-spinner>
            } @else {
              <ng-container>
                <mat-icon>person_add</mat-icon>
                <span>Créer le compte</span>
              </ng-container>
            }
          </button>
        </form>
      </div>

      <div class="divider">
        <span>OU</span>
      </div>

      <div class="auth-footer">
        <p>Déjà un compte ?</p>
        <a routerLink="/auth/login" class="login-link-btn">
          <mat-icon>login</mat-icon>
          Se connecter
        </a>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Version info -->
  <div class="app-info">
    <span>Mobile Money App v1.0</span>
  </div>
</div>
