<div class="dashboard-container">
  <!-- Header -->
  <header class="app-header">
    <div class="user-info">
      <div class="avatar">
        {{ user()?.nomComplet?.charAt(0) || 'U' }}{{ (user()?.nomComplet?.split(' ') || [])[1]?.charAt(0) || '' }}
      </div>
      <div class="greeting">
        <span class="greeting-text">{{ greeting() }},</span>
        <span class="user-name">{{ (user()?.nomComplet?.split(' ') || [])[0] || 'Utilisateur' }}</span>
      </div>
    </div>
    <div class="header-actions">
      <button mat-icon-button class="notification-btn">
        <mat-icon>notifications_none</mat-icon>
        <span class="notification-badge"></span>
      </button>
      <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>menu</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item routerLink="/profile">
          <mat-icon>person</mat-icon>
          <span>Mon profil</span>
        </button>
        <button mat-menu-item routerLink="/settings">
          <mat-icon>settings</mat-icon>
          <span>Paramètres</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>exit_to_app</mat-icon>
          <span>Déconnexion</span>
        </button>
      </mat-menu>
    </div>
  </header>

  <!-- Balance Card -->
  <div class="balance-card">
    <div class="balance-header">
      <mat-icon>account_balance_wallet</mat-icon>
      <span>Solde disponible</span>
      <button mat-icon-button class="toggle-visibility" (click)="toggleBalanceVisibility()">
        <mat-icon>{{ showBalance() ? 'visibility' : 'visibility_off' }}</mat-icon>
      </button>
    </div>
    <div class="balance-amount">
      @if (showBalance()) {
      {{ wallet()?.solde | currencyXOF }}
      } @else {
      ••••••
      }
    </div>
    <div class="balance-divider"></div>
    <div class="savings-row">
      <mat-icon>trending_up</mat-icon>
      <span>Épargne</span>
      <span class="savings-amount">
        @if (showBalance()) {
        {{ totalSavings | currencyXOF }}
        } @else {
        ••••
        }
      </span>
    </div>
  </div>

  <!-- Quick Actions -->
  <section class="quick-actions-section">
    <h2 class="section-title">Actions rapides</h2>
    <div class="quick-actions-grid">
      <div class="quick-action-item" (click)="navigateTo('/transactions/deposit')">
        <div class="action-icon deposit">
          <mat-icon>download</mat-icon>
        </div>
        <span class="action-label">Dépôt</span>
      </div>

      <div class="quick-action-item" (click)="navigateTo('/transactions/withdraw')">
        <div class="action-icon withdraw">
          <mat-icon>upload</mat-icon>
        </div>
        <span class="action-label">Retrait</span>
      </div>

      <div class="quick-action-item" (click)="navigateTo('/transactions/transfer')">
        <div class="action-icon transfer">
          <mat-icon>send</mat-icon>
        </div>
        <span class="action-label">Transfert</span>
      </div>

      <div class="quick-action-item" (click)="navigateTo('/transactions/merchant-payment')">
        <div class="action-icon payment">
          <mat-icon>store</mat-icon>
        </div>
        <span class="action-label">Paiement</span>
      </div>

      <div class="quick-action-item" (click)="navigateTo('/savings')">
        <div class="action-icon savings">
          <mat-icon>savings</mat-icon>
        </div>
        <span class="action-label">Épargne</span>
      </div>

      <div class="quick-action-item" (click)="openScanner()">
        <div class="action-icon scanner">
          <mat-icon>qr_code_scanner</mat-icon>
        </div>
        <span class="action-label">Scanner</span>
      </div>
    </div>
  </section>

  <!-- Recent Transactions -->
  <section class="transactions-section">
    <div class="section-header">
      <h2 class="section-title">Transactions récentes</h2>
      <a class="view-all-link" routerLink="/transactions/history">
        Voir tout
        <mat-icon>chevron_right</mat-icon>
      </a>
    </div>

    @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="32"></mat-spinner>
    </div>
    } @else if (recentTransactions.length > 0) {
    <div class="transactions-list">
      @for (transaction of recentTransactions; track transaction.id) {
      <div class="transaction-item" (click)="viewTransaction(transaction)">
        <div class="transaction-icon" [class]="getTransactionIconClass(transaction.type)">
          <mat-icon>{{ getTransactionIcon(transaction.type) }}</mat-icon>
        </div>
        <div class="transaction-details">
          <span class="transaction-title">{{ getTransactionTitle(transaction) }}</span>
          <span class="transaction-date">{{ transaction.dateCreation | date:'dd MMM, HH:mm' }}</span>
        </div>
        <div class="transaction-amount" [class]="getAmountClass(transaction.type)">
          {{ getAmountSign(transaction.type) }}{{ transaction.montant | currencyXOF }}
        </div>
      </div>
      }
    </div>
    } @else {
    <div class="empty-state">
      <mat-icon>receipt_long</mat-icon>
      <p>Aucune transaction récente</p>
    </div>
    }
  </section>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a class="nav-item active" routerLink="/dashboard" routerLinkActive="active">
      <mat-icon>home</mat-icon>
      <span>Accueil</span>
    </a>
    <a class="nav-item" routerLink="/transactions/history" routerLinkActive="active">
      <mat-icon>history</mat-icon>
      <span>Historique</span>
    </a>
    <a class="nav-item" routerLink="/profile" routerLinkActive="active">
      <mat-icon>person_outline</mat-icon>
      <span>Profil</span>
    </a>
    <a class="nav-item" routerLink="/settings" routerLinkActive="active">
      <mat-icon>settings</mat-icon>
      <span>Paramètres</span>
    </a>
  </nav>
</div>