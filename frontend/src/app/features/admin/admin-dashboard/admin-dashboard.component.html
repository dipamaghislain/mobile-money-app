<!-- frontend/src/app/features/admin/admin-dashboard/admin-dashboard.component.html -->
<div class="dashboard">
  <!-- Welcome Banner -->
  <div class="welcome-banner">
    <div class="welcome-content">
      <h1>Bienvenue sur votre tableau de bord üëã</h1>
      <p>Voici un aper√ßu de l'activit√© de votre plateforme aujourd'hui</p>
    </div>
    <div class="welcome-date">
      <mat-icon>calendar_today</mat-icon>
      <span>{{ today | date:'EEEE d MMMM yyyy':'':'fr' }}</span>
    </div>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading-overlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Chargement des donn√©es...</p>
      </div>
    </div>
  }

  @if (!loading() && !error()) {
    <!-- KPI Cards -->
    <div class="kpi-grid">
      <div class="kpi-card users">
        <div class="kpi-header">
          <div class="kpi-icon">
            <mat-icon>people</mat-icon>
          </div>
          <div class="kpi-trend up">
            <mat-icon>trending_up</mat-icon>
            <span>+12%</span>
          </div>
        </div>
        <div class="kpi-value">{{ statistics()?.utilisateurs?.total || 0 | number }}</div>
        <div class="kpi-label">Utilisateurs totaux</div>
        <div class="kpi-footer">
          <span class="highlight">{{ statistics()?.utilisateurs?.actifs || 0 }}</span> actifs ce mois
        </div>
      </div>

      <div class="kpi-card transactions">
        <div class="kpi-header">
          <div class="kpi-icon">
            <mat-icon>receipt_long</mat-icon>
          </div>
          <div class="kpi-trend up">
            <mat-icon>trending_up</mat-icon>
            <span>+8%</span>
          </div>
        </div>
        <div class="kpi-value">{{ statistics()?.transactions?.total || 0 | number }}</div>
        <div class="kpi-label">Transactions totales</div>
        <div class="kpi-footer">
          <span class="highlight">{{ statistics()?.transactions?.derniers7jours || 0 }}</span> cette semaine
        </div>
      </div>

      <div class="kpi-card volume">
        <div class="kpi-header">
          <div class="kpi-icon">
            <mat-icon>payments</mat-icon>
          </div>
          <div class="kpi-trend up">
            <mat-icon>trending_up</mat-icon>
            <span>+23%</span>
          </div>
        </div>
        <div class="kpi-value">{{ formatCurrency(statistics()?.transactions?.volumeTotal || 0) }}</div>
        <div class="kpi-label">Volume total</div>
        <div class="kpi-footer">
          En <span class="highlight">FCFA</span>
        </div>
      </div>

      <div class="kpi-card merchants">
        <div class="kpi-header">
          <div class="kpi-icon">
            <mat-icon>store</mat-icon>
          </div>
          <div class="kpi-trend neutral">
            <mat-icon>remove</mat-icon>
            <span>0%</span>
          </div>
        </div>
        <div class="kpi-value">{{ statistics()?.utilisateurs?.marchands || 0 | number }}</div>
        <div class="kpi-label">Marchands actifs</div>
        <div class="kpi-footer">
          Comptes professionnels
        </div>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="main-grid">
      <!-- Transaction Overview -->
      <div class="card chart-card">
        <div class="card-header">
          <div class="card-title">
            <h3>Vue d'ensemble des transactions</h3>
            <p>R√©partition par type</p>
          </div>
          <div class="card-actions">
            <button mat-stroked-button class="period-btn active">7j</button>
            <button mat-stroked-button class="period-btn">30j</button>
            <button mat-stroked-button class="period-btn">90j</button>
          </div>
        </div>
        <div class="card-body">
          <div class="transaction-stats">
            @if (statistics()?.transactions?.parType) {
              @for (stat of statistics()!.transactions.parType; track stat._id) {
                <div class="stat-row">
                  <div class="stat-info">
                    <div class="stat-icon" [class]="stat._id.toLowerCase()">
                      <mat-icon>{{ getTransactionIcon(stat._id) }}</mat-icon>
                    </div>
                    <div class="stat-text">
                      <span class="stat-name">{{ getTransactionLabel(stat._id) }}</span>
                      <span class="stat-count">{{ stat.count | number }} op√©rations</span>
                    </div>
                  </div>
                  <div class="stat-value">
                    <span class="amount">{{ stat.volumeTotal | number:'1.0-0' }} F</span>
                    <div class="progress-bar">
                      <div class="progress" [style.width.%]="getProgressWidth(stat.volumeTotal)" [class]="stat._id.toLowerCase()"></div>
                    </div>
                  </div>
                </div>
              }
            } @else {
              <div class="empty-chart">
                <mat-icon>insert_chart</mat-icon>
                <p>Aucune donn√©e disponible</p>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="card activity-card">
        <div class="card-header">
          <div class="card-title">
            <h3>Activit√© r√©cente</h3>
            <p>Derni√®res transactions</p>
          </div>
          <a mat-button color="primary" routerLink="/admin/transactions">
            Voir tout
            <mat-icon>arrow_forward</mat-icon>
          </a>
        </div>
        <div class="card-body">
          @if (dashboard()?.dernieresTransactions?.length) {
            <div class="activity-list">
              @for (tx of dashboard()!.dernieresTransactions.slice(0, 6); track tx._id) {
                <div class="activity-item">
                  <div class="activity-icon" [class]="tx.type.toLowerCase()">
                    <mat-icon>{{ getTransactionIcon(tx.type) }}</mat-icon>
                  </div>
                  <div class="activity-info">
                    <span class="activity-title">{{ getTransactionLabel(tx.type) }}</span>
                    <span class="activity-time">{{ tx.dateCreation | date:'dd/MM √† HH:mm' }}</span>
                  </div>
                  <div class="activity-amount" [class]="tx.type === 'DEPOSIT' ? 'credit' : 'debit'">
                    {{ tx.type === 'DEPOSIT' ? '+' : '-' }}{{ tx.montant | number:'1.0-0' }} F
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-activity">
              <mat-icon>history</mat-icon>
              <p>Aucune transaction r√©cente</p>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Bottom Grid -->
    <div class="bottom-grid">
      <!-- New Users -->
      <div class="card users-card">
        <div class="card-header">
          <div class="card-title">
            <h3>Nouveaux utilisateurs</h3>
            <p>Inscriptions r√©centes</p>
          </div>
          <a mat-button color="primary" routerLink="/admin/users">
            G√©rer
            <mat-icon>arrow_forward</mat-icon>
          </a>
        </div>
        <div class="card-body">
          @if (dashboard()?.nouvellesInscriptions?.length) {
            <div class="users-list">
              @for (user of dashboard()!.nouvellesInscriptions.slice(0, 5); track user._id) {
                <div class="user-row">
                  <div class="user-avatar" [style.background]="getAvatarColor(user.nomComplet)">
                    {{ getInitials(user.nomComplet) }}
                  </div>
                  <div class="user-info">
                    <span class="user-name">{{ user.nomComplet }}</span>
                    <span class="user-phone">{{ user.telephone }}</span>
                  </div>
                  <div class="user-badge" [class]="user.role">
                    {{ user.role }}
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-users">
              <mat-icon>person_add</mat-icon>
              <p>Aucune inscription r√©cente</p>
            </div>
          }
        </div>
      </div>

      <!-- Alerts -->
      <div class="card alerts-card">
        <div class="card-header">
          <div class="card-title">
            <h3>Alertes syst√®me</h3>
            <p>√âl√©ments n√©cessitant attention</p>
          </div>
        </div>
        <div class="card-body">
          @if (dashboard()?.transactionsEchouees?.length || dashboard()?.utilisateursBloques?.length) {
            <div class="alerts-list">
              @if (dashboard()?.transactionsEchouees?.length) {
                <div class="alert-item error">
                  <div class="alert-icon">
                    <mat-icon>error</mat-icon>
                  </div>
                  <div class="alert-content">
                    <span class="alert-title">{{ dashboard()!.transactionsEchouees.length }} transaction(s) √©chou√©e(s)</span>
                    <span class="alert-desc">N√©cessitent une v√©rification</span>
                  </div>
                  <mat-icon class="alert-arrow">chevron_right</mat-icon>
                </div>
              }
              @if (dashboard()?.utilisateursBloques?.length) {
                <div class="alert-item warning">
                  <div class="alert-icon">
                    <mat-icon>block</mat-icon>
                  </div>
                  <div class="alert-content">
                    <span class="alert-title">{{ dashboard()!.utilisateursBloques.length }} compte(s) bloqu√©(s)</span>
                    <span class="alert-desc">En attente de d√©blocage</span>
                  </div>
                  <mat-icon class="alert-arrow">chevron_right</mat-icon>
                </div>
              }
            </div>
          } @else {
            <div class="success-state">
              <div class="success-icon">
                <mat-icon>check_circle</mat-icon>
              </div>
              <h4>Tout va bien !</h4>
              <p>Aucune alerte √† signaler</p>
            </div>
          }
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card actions-card">
        <div class="card-header">
          <div class="card-title">
            <h3>Actions rapides</h3>
            <p>Acc√®s fr√©quents</p>
          </div>
        </div>
        <div class="card-body">
          <div class="actions-grid">
            <a class="action-btn" routerLink="/admin/users">
              <div class="action-icon users">
                <mat-icon>person_add</mat-icon>
              </div>
              <span>Ajouter utilisateur</span>
            </a>
            <a class="action-btn" routerLink="/admin/transactions">
              <div class="action-icon transactions">
                <mat-icon>search</mat-icon>
              </div>
              <span>Rechercher transaction</span>
            </a>
            <a class="action-btn" routerLink="/admin/settings">
              <div class="action-icon settings">
                <mat-icon>tune</mat-icon>
              </div>
              <span>Param√®tres</span>
            </a>
            <a class="action-btn" routerLink="/admin/reports">
              <div class="action-icon reports">
                <mat-icon>download</mat-icon>
              </div>
              <span>Exporter rapport</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <mat-icon>cloud_off</mat-icon>
      <h3>Erreur de chargement</h3>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="loadData()">
        <mat-icon>refresh</mat-icon>
        R√©essayer
      </button>
    </div>
  }
</div>
