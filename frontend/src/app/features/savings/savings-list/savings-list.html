<div class="savings-container">
    <div class="savings-header">
        <h1>
            <mat-icon>savings</mat-icon>
            Mes Tirelires
        </h1>
        <button mat-raised-button color="primary" routerLink="/savings/create">
            <mat-icon>add</mat-icon>
            <span>Créer une tirelire</span>
        </button>
    </div>

    @if (loading()) {
    <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Chargement de vos tirelires...</p>
    </div>
    } @else if (error()) {
    <div class="error-container">
        <mat-icon>error_outline</mat-icon>
        <p>{{ error() }}</p>
        <button mat-raised-button color="primary" (click)="loadSavings()">
            Réessayer
        </button>
    </div>
    } @else if (savings().length === 0) {
    <div class="empty-state">
        <mat-icon>account_balance_wallet</mat-icon>
        <h2>Aucune tirelire</h2>
        <p>Créez votre première tirelire pour commencer à épargner !</p>
        <button mat-raised-button color="primary" routerLink="/savings/create">
            <mat-icon>add</mat-icon>
            <span>Créer une tirelire</span>
        </button>
    </div>
    } @else {
    <div class="savings-grid">
        @for (saving of savings(); track saving.id) {
        <mat-card class="saving-card">
            <mat-card-header>
                <div class="saving-icon" [style.background-color]="saving.couleur || '#4CAF50'">
                    <mat-icon>{{ saving.icone || 'account_balance_wallet' }}</mat-icon>
                </div>
                <div class="saving-header-content">
                    <mat-card-title>{{ saving.nom }}</mat-card-title>
                    <mat-card-subtitle>
                        <mat-chip [color]="getStatusColor(saving.statut)">
                            {{ getStatusLabel(saving.statut) }}
                        </mat-chip>
                    </mat-card-subtitle>
                </div>
            </mat-card-header>

            <mat-card-content>
                @if (saving.description) {
                <p class="saving-description">{{ saving.description }}</p>
                }

                <div class="saving-amounts">
                    <div class="amount-item">
                        <span class="amount-label">Montant actuel</span>
                        <span class="amount-value primary">
                            {{ saving.montantActuel | currency:'XOF':'symbol':'1.0-0' }}
                        </span>
                    </div>
                    @if (saving.objectifMontant) {
                    <div class="amount-item">
                        <span class="amount-label">Objectif</span>
                        <span class="amount-value">
                            {{ saving.objectifMontant | currency:'XOF':'symbol':'1.0-0' }}
                        </span>
                    </div>
                    }
                </div>

                @if (saving.objectifMontant) {
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" [style.width.%]="getProgress(saving)"></div>
                    </div>
                    <span class="progress-text">{{ getProgress(saving) | number:'1.0-0' }}%</span>
                </div>
                }

                @if (saving.dateObjectif) {
                <div class="saving-date">
                    <mat-icon>event</mat-icon>
                    <span>Objectif : {{ saving.dateObjectif | date:'dd/MM/yyyy' }}</span>
                </div>
                }
            </mat-card-content>

            <mat-card-actions>
                <button mat-button color="primary" [routerLink]="['/savings', saving.id]">
                    <mat-icon>visibility</mat-icon>
                    <span>Voir détails</span>
                </button>
            </mat-card-actions>
        </mat-card>
        }
    </div>
    }
</div>
